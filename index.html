<!DOCTYPE html>
<html>
<head>
<title>Editor 1024</title>
<style>
#c{
  width:1024px;
  height:1024px;
  border:1px solid #000;
  position:relative;
  margin-top:10px;
  background:#f9f9f9;
}
.box{
  position:absolute;
  border:1px dashed #333;
  transform-origin:center center;
}
.handle{width:10px;height:10px;background:#fff;border:1px solid #000;position:absolute}
.handle.corner{cursor:nwse-resize}
.handle.side-x{cursor:ew-resize}
.handle.side-y{cursor:ns-resize}
.handle.rotate{cursor:grab;width:12px;height:12px;border-radius:50%;background:#0af;top:-25px;left:50%;transform:translateX(-50%)}
</style>
</head>
<body>
<button id="add">Add Rect</button>
<button id="send">Send Data</button>
<div id="c"></div>
<script>
const c=document.getElementById("c")

function updateBox(b){
 let x=+b.dataset.x, y=+b.dataset.y, w=+b.dataset.w, h=+b.dataset.h, rot=+b.dataset.rot
 b.style.width=w+"px"
 b.style.height=h+"px"
 b.style.left=(x-w/2)+"px"
 b.style.top=(y-h/2)+"px"
 b.style.transform=`rotate(${rot}deg)`
}

document.getElementById("add").onclick=()=>{
 let b=document.createElement("div")
 b.className="box"
 b.dataset.x=512
 b.dataset.y=512
 b.dataset.w=200
 b.dataset.h=150
 b.dataset.rot=0
 updateBox(b)
 addHandles(b)
 c.appendChild(b)
}

function addHandles(b){
 let corners=["tl","tr","bl","br"]
 corners.forEach(pos=>{
   let h=document.createElement("div")
   h.className="handle corner "+pos
   if(pos==="tl"){h.style.left="-5px";h.style.top="-5px"}
   if(pos==="tr"){h.style.right="-5px";h.style.top="-5px"}
   if(pos==="bl"){h.style.left="-5px";h.style.bottom="-5px"}
   if(pos==="br"){h.style.right="-5px";h.style.bottom="-5px"}
   b.appendChild(h)
   h.onmousedown=e=>resizeStart(e,b,pos)
 })
 ;["top","bottom"].forEach(pos=>{
   let h=document.createElement("div")
   h.className="handle side-y "+pos
   h.style[pos]="-5px";h.style.left="50%";h.style.transform="translateX(-50%)"
   b.appendChild(h)
   h.onmousedown=e=>resizeStart(e,b,pos)
 })
 ;["left","right"].forEach(pos=>{
   let h=document.createElement("div")
   h.className="handle side-x "+pos
   h.style[pos]="-5px";h.style.top="50%";h.style.transform="translateY(-50%)"
   b.appendChild(h)
   h.onmousedown=e=>resizeStart(e,b,pos)
 })
 let rot=document.createElement("div")
 rot.className="handle rotate"
 b.appendChild(rot)
 rot.onmousedown=e=>rotateStart(e,b)
 
 b.onmousedown=e=>{
   if(e.target!==b) return
   let startX=e.clientX, startY=e.clientY
   let x=+b.dataset.x, y=+b.dataset.y
   document.onmousemove=ev=>{
     let dx=ev.clientX-startX, dy=ev.clientY-startY
     b.dataset.x=x+dx
     b.dataset.y=y+dy
     updateBox(b)
   }
   document.onmouseup=()=>{document.onmousemove=null}
 }
}

function resizeStart(e,box,dir){
 e.stopPropagation()
 let startX=e.clientX, startY=e.clientY
 let w=+box.dataset.w, h=+box.dataset.h
 let x=+box.dataset.x, y=+box.dataset.y
 let rot=+box.dataset.rot*Math.PI/180
 document.onmousemove=ev=>{
   let dx=(ev.clientX-startX)
   let dy=(ev.clientY-startY)
   let localX=dx*Math.cos(-rot)-dy*Math.sin(-rot)
   let localY=dx*Math.sin(-rot)+dy*Math.cos(-rot)
   let newW=w, newH=h, newX=x, newY=y
   if(dir==="tr"){newW=w+localX; newH=h-localY; newY=y+localY/2}
   if(dir==="tl"){newW=w-localX; newX=x+localX/2; newH=h-localY; newY=y+localY/2}
   if(dir==="br"){newW=w+localX; newH=h+localY; newY=y+localY/2}
   if(dir==="bl"){newW=w-localX; newX=x+localX/2; newH=h+localY; newY=y+localY/2}
   if(dir==="top"){newH=h-localY; newY=y+localY/2}
   if(dir==="bottom"){newH=h+localY; newY=y+localY/2}
   if(dir==="left"){newW=w-localX; newX=x+localX/2}
   if(dir==="right"){newW=w+localX; newX=x+localX/2}
   if(newW>20 && newH>20){
     box.dataset.w=newW
     box.dataset.h=newH
     box.dataset.x=newX
     box.dataset.y=newY
     updateBox(box)
   }
 }
 document.onmouseup=()=>{document.onmousemove=null}
}

function rotateStart(e,box){
 e.stopPropagation()
 let rect=box.getBoundingClientRect()
 let cx=rect.left+rect.width/2, cy=rect.top+rect.height/2
 document.onmousemove=ev=>{
   let angle=Math.atan2(ev.clientY-cy,ev.clientX-cx)*180/Math.PI
   box.dataset.rot=angle
   updateBox(box)
 }
 document.onmouseup=()=>{document.onmousemove=null}
}

document.getElementById("send").onclick=()=>{
 let d=[...document.querySelectorAll(".box")].map(b=>{
   return {
     x:+b.dataset.x,
     y:+b.dataset.y,
     w:+b.dataset.w,
     h:+b.dataset.h,
     rot:+b.dataset.rot
   }
 })
 console.log(JSON.stringify(d))
}
</script>
</body>
</html>
