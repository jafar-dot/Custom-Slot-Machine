<!DOCTYPE html>
<html>
<head>
<title>Editor 1024 Space</title>
<style>
body {
  margin:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:flex-start;
  height:100vh;
  background:#f0f2f5;
  font-family:Arial, sans-serif;
}
#toolbar {
  display:flex;
  gap:10px;
  margin:15px;
}
button {
  background:#007bff;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:6px;
  font-size:15px;
  cursor:pointer;
  transition:background 0.3s;
}
button:hover { background:#0056b3; }
#outer {
  flex:1;
  display:flex;
  align-items:center;
  justify-content:center;
  width:100%;
}
#workspace {
  position:relative;
  width:90vmin;
  height:90vmin;
  border:2px solid #000;
  background:#fff;
}
.box {
  position:absolute;
  border:1px dashed #333;
  background:rgba(255,0,0,0.2);
  transform-origin:0 0;
}
.handle{width:10px;height:10px;background:#fff;border:1px solid #000;position:absolute}
.handle.corner{cursor:nwse-resize}
.handle.side-x{cursor:ew-resize}
.handle.side-y{cursor:ns-resize}
.handle.rotate{cursor:grab;width:12px;height:12px;border-radius:50%;background:#0af;top:-25px;left:50%;transform:translateX(-50%)}
#messageArea {
  width:90%;
  max-width:700px;
  margin:15px;
  display:flex;
  flex-direction:column;
  gap:8px;
}
#msgLabel {
  font-size:14px;
  font-weight:bold;
}
#msgInput {
  resize:none;
  padding:10px;
  font-size:14px;
  border:1px solid #ccc;
  border-radius:6px;
  min-height:60px;
}
</style>
</head>
<body>
<div id="toolbar">
  <button id="addRect">Add Rect</button>
  <button id="send">Send</button>
</div>
<div id="outer">
  <div id="workspace"></div>
</div>
<div id="messageArea">
  <div id="msgLabel">Message:</div>
  <textarea id="msgInput" placeholder="Type your message..."></textarea>
  <button id="sendMsg">Send Data</button>
</div>

<script>
const c=document.getElementById("workspace")
const SPACE=1024

function toScreen(v){return v * (c.clientWidth/SPACE)}
function fromScreen(v){return v / (c.clientWidth/SPACE)}

function updateBox(b){
  b.style.width=toScreen(+b.dataset.w)+"px"
  b.style.height=toScreen(+b.dataset.h)+"px"
  b.style.left=toScreen(+b.dataset.x)+"px"
  b.style.top=toScreen(+b.dataset.y)+"px"
  b.style.transform=`rotate(${+b.dataset.rot}deg)`
}

function addBox(x=100,y=100,w=200,h=150){
  let b=document.createElement("div")
  b.className="box"
  b.dataset.x=x; b.dataset.y=y; b.dataset.w=w; b.dataset.h=h; b.dataset.rot=0
  updateBox(b)
  addHandles(b)
  c.appendChild(b)
}

function addHandles(b){
  let corners=["tl","tr","bl","br"]
  corners.forEach(pos=>{
    let h=document.createElement("div")
    h.className="handle corner "+pos
    if(pos==="tl"){h.style.left="-5px";h.style.top="-5px"}
    if(pos==="tr"){h.style.right="-5px";h.style.top="-5px"}
    if(pos==="bl"){h.style.left="-5px";h.style.bottom="-5px"}
    if(pos==="br"){h.style.right="-5px";h.style.bottom="-5px"}
    b.appendChild(h)
    h.onmousedown=e=>resizeStart(e,b,pos)
  })
  ;["top","bottom"].forEach(pos=>{
    let h=document.createElement("div")
    h.className="handle side-y "+pos
    h.style[pos]="-5px";h.style.left="50%";h.style.transform="translateX(-50%)"
    b.appendChild(h)
    h.onmousedown=e=>resizeStart(e,b,pos)
  })
  ;["left","right"].forEach(pos=>{
    let h=document.createElement("div")
    h.className="handle side-x "+pos
    h.style[pos]="-5px";h.style.top="50%";h.style.transform="translateY(-50%)"
    b.appendChild(h)
    h.onmousedown=e=>resizeStart(e,b,pos)
  })
  let rot=document.createElement("div")
  rot.className="handle rotate"
  b.appendChild(rot)
  rot.onmousedown=e=>rotateStart(e,b)

  // Move box
  b.onmousedown=e=>{
    if(e.target!==b) return
    let startX=e.clientX, startY=e.clientY
    let x=+b.dataset.x, y=+b.dataset.y
    document.onmousemove=ev=>{
      let dx=fromScreen(ev.clientX-startX), dy=fromScreen(ev.clientY-startY)
      let newX=Math.min(Math.max(0,x+dx),SPACE-+b.dataset.w)
      let newY=Math.min(Math.max(0,y+dy),SPACE-+b.dataset.h)
      b.dataset.x=newX
      b.dataset.y=newY
      updateBox(b)
    }
    document.onmouseup=()=>document.onmousemove=null
  }
}

function resizeStart(e,box,dir){
  e.stopPropagation()
  let startX=e.clientX, startY=e.clientY
  let w=+box.dataset.w, h=+box.dataset.h
  let x=+box.dataset.x, y=+box.dataset.y
  let rot=+box.dataset.rot*Math.PI/180
  document.onmousemove=ev=>{
    let dx=fromScreen(ev.clientX-startX)
    let dy=fromScreen(ev.clientY-startY)
    let localX=dx*Math.cos(-rot)-dy*Math.sin(-rot)
    let localY=dx*Math.sin(-rot)+dy*Math.cos(-rot)
    let newW=w, newH=h, newX=x, newY=y
    if(dir==="tr"){newW=w+localX; newH=h-localY; newY=y+localY}
    if(dir==="tl"){newW=w-localX; newX=x+localX; newH=h-localY; newY=y+localY}
    if(dir==="br"){newW=w+localX; newH=h+localY}
    if(dir==="bl"){newW=w-localX; newX=x+localX; newH=h+localY}
    if(dir==="top"){newH=h-localY; newY=y+localY}
    if(dir==="bottom"){newH=h+localY}
    if(dir==="left"){newW=w-localX; newX=x+localX}
    if(dir==="right"){newW=w+localX}
    if(newW>=20 && newH>=20 && newX>=0 && newY>=0 && newX+newW<=SPACE && newY+newH<=SPACE){
      box.dataset.w=newW; box.dataset.h=newH; box.dataset.x=newX; box.dataset.y=newY
      updateBox(box)
    }
  }
  document.onmouseup=()=>document.onmousemove=null
}

function rotateStart(e,box){
  e.stopPropagation()
  let rect=c.getBoundingClientRect()
  let cx=toScreen(+box.dataset.x + +box.dataset.w/2) + rect.left
  let cy=toScreen(+box.dataset.y + +box.dataset.h/2) + rect.top
  document.onmousemove=ev=>{
    let angle=Math.atan2(ev.clientY-cy,ev.clientX-cx)*180/Math.PI
    box.dataset.rot=angle
    updateBox(box)
  }
  document.onmouseup=()=>document.onmousemove=null
}

function collectData(){
  return [...document.querySelectorAll(".box")].map(b=>({
    x:+b.dataset.x,
    y:+b.dataset.y,
    w:+b.dataset.w,
    h:+b.dataset.h,
    rot:+b.dataset.rot
  }))
}

document.getElementById("addRect").onclick=()=>addBox(100,100,200,150)
document.getElementById("send").onclick=()=>console.log(JSON.stringify(collectData(),null,2))
document.getElementById("sendMsg").onclick=()=>{
  let msg=document.getElementById("msgInput").value
  console.log("Message:",msg)
  console.log("Rects:",JSON.stringify(collectData(),null,2))
}
</script>
</body>
</html>
