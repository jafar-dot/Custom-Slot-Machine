<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slot Editor 1024</title>
<style>
html, body {
  margin:0;
  height:100%;
  display:flex;
  flex-direction:column;
  font-family: Arial, sans-serif;
  background: #f0f2f5;
}
#toolbar {
  display:flex;
  justify-content:center;
  padding:10px;
  background:#fff;
  flex-shrink:0;
  border-bottom:1px solid #ccc;
}
button {
  background:#007bff;
  color:#fff;
  border:none;
  padding:10px 18px;
  border-radius:6px;
  font-size:15px;
  cursor:pointer;
  transition:background 0.3s;
}
button:hover { background:#0056b3; }
#workspace-container {
  flex:1;
  display:flex;
  justify-content:center;
  align-items:center;
  position:relative;
  min-height:0;
}
#workspace {
  position:relative;
  width:90vmin;
  height:90vmin;
  border:2px solid #000;
  background:#fff;
}
.box {
  position:absolute;
  border:1px dashed #333;
  background:rgba(255,0,0,0.2);
  transform-origin:0 0;
}
.handle{
  width:10px;height:10px;
  background:#fff;
  border:1px solid #000;
  position:absolute;
}
.handle.rotate {
  cursor:grab;
  width:12px;height:12px;
  border-radius:50%;
  background:#0af;
  top:-25px;left:50%;
  transform:translateX(-50%);
}
#messageArea {
  padding:10px;
  background:#fff;
  border-top:1px solid #ccc;
  display:flex;
  flex-direction:column;
  gap:8px;
  flex-shrink:0;
}
#msgLabel { font-size:14px; font-weight:bold; }
#msgInput {
  resize:none;
  padding:10px;
  font-size:14px;
  border:1px solid #ccc;
  border-radius:6px;
  min-height:60px;
}
</style>
</head>
<body>
<div id="toolbar">
  <button id="addRect">Add Rect</button>
</div>
<div id="workspace-container">
  <div id="workspace"></div>
</div>
<div id="messageArea">
  <div id="msgLabel">Message:</div>
  <textarea id="msgInput" placeholder="Type your message11..."></textarea>
  <button id="sendMsg">Send Data</button>
</div>
<script>
const c=document.getElementById("workspace")
const SPACE=1024
function toScreen(v){return v*(c.clientWidth/SPACE)}
function fromScreen(v){return v/(c.clientWidth/SPACE)}
function updateBox(b){
  let x=+b.dataset.x, y=+b.dataset.y, w=+b.dataset.w, h=+b.dataset.h, rot=+b.dataset.rot
  let rad=rot*Math.PI/180
  let cos=Math.cos(rad), sin=Math.sin(rad)
  let corners=[
    {x:0,y:0},{x:w,y:0},{x:0,y:h},{x:w,y:h}
  ]
  let minX=Math.min(...corners.map(p=>p.x*cos-p.y*sin))
  let maxX=Math.max(...corners.map(p=>p.x*cos-p.y*sin))
  let minY=Math.min(...corners.map(p=>p.x*sin+p.y*cos))
  let maxY=Math.max(...corners.map(p=>p.x*sin+p.y*cos))
  if(x+minX<0) x=-minX
  if(y+minY<0) y=-minY
  if(x+maxX>SPACE) x=SPACE-maxX
  if(y+maxY>SPACE) y=SPACE-maxY
  b.dataset.x=x;b.dataset.y=y
  b.style.width=toScreen(w)+"px"
  b.style.height=toScreen(h)+"px"
  b.style.left=toScreen(x)+"px"
  b.style.top=toScreen(y)+"px"
  b.style.transform=`rotate(${rot}deg)`
}
function addBox(x=100,y=100,w=200,h=150){
  let b=document.createElement("div")
  b.className="box"
  b.dataset.x=x; b.dataset.y=y; b.dataset.w=w; b.dataset.h=h; b.dataset.rot=0
  updateBox(b)
  addHandles(b)
  c.appendChild(b)
  b.oncontextmenu=e=>{e.preventDefault();b.remove()}
}
function addHandles(b){
  const positions=["tl","tr","bl","br","top","bottom","left","right"]
  positions.forEach(pos=>{
    let h=document.createElement("div")
    h.className="handle "+pos
    if(pos==="tl"){h.style.left="-5px";h.style.top="-5px"}
    if(pos==="tr"){h.style.right="-5px";h.style.top="-5px"}
    if(pos==="bl"){h.style.left="-5px";h.style.bottom="-5px"}
    if(pos==="br"){h.style.right="-5px";h.style.bottom="-5px"}
    if(pos==="top"){h.style.top="-5px";h.style.left="50%";h.style.transform="translateX(-50%)"}
    if(pos==="bottom"){h.style.bottom="-5px";h.style.left="50%";h.style.transform="translateX(-50%)"}
    if(pos==="left"){h.style.left="-5px";h.style.top="50%";h.style.transform="translateY(-50%)"}
    if(pos==="right"){h.style.right="-5px";h.style.top="50%";h.style.transform="translateY(-50%)"}
    b.appendChild(h)
    h.onmousedown=e=>resizeStart(e,b,pos)
  })
  let rot=document.createElement("div")
  rot.className="handle rotate"
  b.appendChild(rot)
  rot.onmousedown=e=>rotateStart(e,b)
  b.onmousedown=e=>{
    if(e.target!==b) return
    let startX=e.clientX, startY=e.clientY
    let x=+b.dataset.x, y=+b.dataset.y
    document.onmousemove=ev=>{
      let dx=fromScreen(ev.clientX-startX), dy=fromScreen(ev.clientY-startY)
      b.dataset.x=Math.min(Math.max(0,x+dx),SPACE-+b.dataset.w)
      b.dataset.y=Math.min(Math.max(0,y+dy),SPACE-+b.dataset.h)
      updateBox(b)
    }
    document.onmouseup=()=>document.onmousemove=null
  }
}
function resizeStart(e,box,dir){
  e.stopPropagation()
  let startX=e.clientX, startY=e.clientY
  let w=+box.dataset.w,h=+box.dataset.h,x=+box.dataset.x,y=+box.dataset.y
  let rot=+box.dataset.rot*Math.PI/180
  document.onmousemove=ev=>{
    let dx=fromScreen(ev.clientX-startX), dy=fromScreen(ev.clientY-startY)
    let localX=dx*Math.cos(-rot)-dy*Math.sin(-rot)
    let localY=dx*Math.sin(-rot)+dy*Math.cos(-rot)
    let newW=w,newH=h,newX=x,newY=y
    if(dir==="tr"){newW=w+localX; newH=h-localY; newY=y+localY}
    if(dir==="tl"){newW=w-localX; newX=x+localX; newH=h-localY; newY=y+localY}
    if(dir==="br"){newW=w+localX; newH=h+localY}
    if(dir==="bl"){newW=w-localX; newX=x+localX; newH=h+localY}
    if(dir==="top"){newH=h-localY; newY=y+localY}
    if(dir==="bottom"){newH=h+localY}
    if(dir==="left"){newW=w-localX; newX=x+localX}
    if(dir==="right"){newW=w+localX}
    if(newW>=20 && newH>=20){
      box.dataset.w=newW; box.dataset.h=newH; box.dataset.x=newX; box.dataset.y=newY
      updateBox(box)
    }
  }
  document.onmouseup=()=>document.onmousemove=null
}
function rotateStart(e,box){
  e.stopPropagation()
  let rect=c.getBoundingClientRect()
  let cx=toScreen(+box.dataset.x + +box.dataset.w/2) + rect.left
  let cy=toScreen(+box.dataset.y + +box.dataset.h/2) + rect.top
  document.onmousemove=ev=>{
    let angle=Math.atan2(ev.clientY-cy,ev.clientX-cx)*180/Math.PI
    box.dataset.rot=angle
    updateBox(box)
  }
  document.onmouseup=()=>document.onmousemove=null
}
function collectData(){
  return [...document.querySelectorAll(".box")].map(b=>({
    x:+b.dataset.x,
    y:+b.dataset.y,
    w:+b.dataset.w,
    h:+b.dataset.h,
    rot:+b.dataset.rot
  }))
}
document.getElementById("addRect").onclick=()=>addBox(100,100,200,150)
document.getElementById("sendMsg").onclick=()=>{
  let msg=document.getElementById("msgInput").value
  console.log("Message:",msg)
  console.log("Rects:",JSON.stringify(collectData(),null,2))
}
</script>
</body>
</html>
